package fr.xs.cms.services.ajax.image;public class DivClipplet {	private boolean auto_refresh;	private int     auto_refresh_period_ms;	private String  img_object_id;	private String  img_object_name;/*	private int  	img_object_width;	private int  	img_object_height;		private String send_data;	*/	public DivClipplet() {		img_object_id     = img_object_name = "IMG";//		img_object_width  = 200;//		img_object_height = 200;	}	public DivClipplet setImageName(String _name) {		img_object_id     = _name;		img_object_name   = _name;		return this;	}	public DivClipplet setAutoRefresh(boolean _enabled, int _second) {		auto_refresh           = _enabled;		auto_refresh_period_ms = _second * 1000;		return this;	}	public String addToPreBody() {		String html = "";		if(auto_refresh) {			html += "<script language='JavaScript' type='text/javascript'>"/*				  + AjaxHelper.getJsEncode64()				  + "function ajaxScript() {"				  + "document.getElementById('zone').innerHTML = 'AJAX FUNCTION START';"				  + AjaxHelper.getXmlHttpRequest("xmlhttp")/**				  + "if(window.XMLHttpRequest) xmlhttp = new XMLHttpRequest();"				  + "else xmlhttp = new ActiveXObject('Microsoft.XMLHTTP');"/* /				  + "var xmlhttp;"				  + "try { xmlhttp = new ActiveXObject('Msxml2.XMLHTTP'); }"				  + "catch(e) {"				  + "try { xmlhttp = new ActiveXObject('Microsoft.XMLHTTP'); }"				  + "catch(e2) {"				  + "try { xmlhttp = new XMLHttpRequest(); }"				  + "catch(e3) { xmlhttp = false; }"				  + "}}"/** /				  + ( DivServlet.requestAsync() == "true" ? // Si asynchrone, crÃ©ation du callback						    AjaxHelper.setAjaxCallback( "xmlhttp", updateImage() ) : "")*/				  + "xmlhttp.open('" + DivServlet.requestMethod() + "', '" + DivServlet.requestURL() + "', " + DivServlet.requestAsync() + ");"				  + ( (DivServlet.requestMethod() == "post") ?							"xmlhttp.setRequestHeader('Content-type','application/x-www-form-urlencoded');"							+ "xmlhttp.overrideMimeType('text/plain; charset=x-user-defined');"							+ "xmlhttp.send();"							: "xmlhttp.overrideMimeType('text/plain; charset=x-user-defined');"							+ "xmlhttp.send();")				  + ( DivServlet.requestAsync() == "false" ? // Si synchrone, traitement ici!						  	updateImage()						  	: "")				  + "setTimeout('ajaxScript()', " + auto_refresh_period_ms + ");"				  + "document.getElementById('zone').innerHTML = 'AJAX FUNCTION END';"				  + "}"				  + "</script>";		}		return html;	}	public String addToBody() {		String html = 				"<img src='" + DivServlet.requestURL() + "' id='" + img_object_id + "' name='" + img_object_name + "'/>";		return html;	}	public String addToPostBody() {		String html = "";		if(auto_refresh) {			html += "<script language='JavaScript' type='text/javascript'>"				  + "setTimeout('ajaxScript()', " + auto_refresh_period_ms + ");"				  + "</script>";		}		return html;	}	private String updateImage() {		return "document.getElementById('" + img_object_id +  "').src = 'data:image/jpeg;base64,' + encode64(xmlhttp.response);";	}}